<ol class="breadcrumb">
  <li><%= link_to 'HOME', root_path %></li>
  <li><%= link_to @investigation.construction_name, @investigation %></li>
  <li class="active"><%= @house.house_name %></li>
</ol>

<h2><%= @house.house_name %></h2>
<p><%= link_to '編集', edit_house_path, :class=>"btn btn-default" %></p>

<p>家屋詳細</p>
<table class="table table-striped table-hover">
  <tr>
    <th>ID</th>
    <td class="align-middle"><%= @house.id %></td>
  </tr>
  <tr>
    <th>建物所在地</th>
    <td class="align-middle"><%= @house.prefectures %><%= @house.city %><%= @house.block %></td>
  </tr>
  <tr>
    <th>居住者電話番号</th>
    <td class="align-middle"><%= @house.resident_phone_number %></td>
  </tr>  
  <tr>
    <th>構造</th>
    <td class="align-middle"><%= @house.construction %></td>
  </tr>  
  <tr>
    <th>階数</th>
    <td class="align-middle"><%= @house.floors %></td>
  </tr>
  <tr>
    <th>延面積(m2)</th>
    <td class="align-middle"><%= @house.area %></td>
  </tr>
  <tr>
    <th>用途</th>
    <td class="align-middle"><%= @house.use %></td>
  </tr>
  
  <tr>
    <th>所有者名</th>
    <td class="align-middle"><%= @house.owner_name %></td>
  </tr>
  <tr>
    <th>所有者住所</th>
    <td class="align-middle"><%= @house.owner_prefectures %><%= @house.owner_city %><%= @house.owner_block %></td>
  </tr>  
  <tr>
    <th>所有者電話番号</th>
    <td class="align-middle"><%= @house.owner_phone_number %></td>
  </tr>
</table>
<hr/>
<p>事前調査</p>
<table class="table table-striped table-hover">
  <tr>
    <th>建物概算</th>
    <td class="align-middle"><%= @house.overview_pre_survey %></td>
  </tr> 
  <tr>
    <th>調査範囲</th>
    <td class="align-middle"><%= @house.range_pre_survey %></td>
  </tr>   
</table>
<hr/>
<p>事中調査</p>
<table class="table table-striped table-hover">
  <tr>
    <th>建物概算</th>
    <td class="align-middle"><%= @house.overview_ongoing_survey %></td>
  </tr> 
  <tr>
    <th>調査範囲</th>
    <td class="align-middle"><%= @house.range_ongoing_survey %></td>
  </tr>   
</table>
<hr/>
<p>事後調査</p>
<table class="table table-striped table-hover">
  <tr>
    <th>建物概算</th>
    <td class="align-middle"><%= @house.overview_after_survey %></td>
  </tr> 
  <tr>
    <th>調査範囲</th>
    <td class="align-middle"><%= @house.range_after_survey %></td>
  </tr>   
</table>

<hr/>

<h2>測点一覧</h2>
<p>
  <%= form_tag points_path do %>
    <%= hidden_field_tag :house_id, @house.id %>
    <%= submit_tag "測点の追加", :class => "btn btn-primary" %>
  <% end %>
</p>

<table class="table table-striped table-hover">
  <tr>
    <th class="text-center">No</th>
    <th class="text-center">事前調査</th>
    <th class="text-center">事中調査</th>
    <th class="text-center">事後調査</th>
    <th class="text-center"></th>    
  </tr>
  
  <% @points.each do |point| %>
    <tr>
      <td class="text-center align-middle"><%= point.number %></td>
      <td class="text-center align-middle">
        <% if point.posts.find_by(survey_type: "pre").image1? %>
          <% pre_post = point.posts.find_by(survey_type: "pre") %>
          <%= link_to pre_post.updated_at.strftime('%Y/%m/%d'), pre_post, :class=>"btn btn-default" %>
        <% else %>
          <%= link_to '撮影', edit_post_path(point_id: point.id, survey_type: "pre"), :class=>"btn btn-primary" %>
        <% end %>
      </td>
      <td class="text-center align-middle">
        <% if point.posts.find_by(survey_type: "ongoing").image1? %>
          <% ongoing_post = point.posts.find_by(survey_type: "ongoing") %>
          <%= link_to ongoing_post.updated_at.strftime('%Y/%m/%d'), ongoing_post, :class=>"btn btn-default" %>
        <% else %>
          <%= link_to '撮影', edit_post_path(point_id: point.id, survey_type: "ongoing"), :class=>"btn btn-primary" %>
        <% end %>
      </td>
      <td class="text-center align-middle">
        <% if point.posts.find_by(survey_type: "after").image1? %>
          <% after_post = point.posts.find_by(survey_type: "after") %>
          <%= link_to after_post.updated_at.strftime('%Y/%m/%d'), after_post, :class=>"btn btn-default" %>
        <% else %>
          <%= link_to '撮影', edit_post_path(point_id: point.id, survey_type: "after"), :class=>"btn btn-primary" %>
        <% end %>
      </td>
      <td class="text-center align-middle"><%= link_to "削除", point, :class=>"btn btn-danger", method: :delete, data: { confirm: '本当に削除してよろしいですか？' } %></td>
    </tr>
  <% end %>
</table>